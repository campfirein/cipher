(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{581:(e,s,t)=>{Promise.resolve().then(t.bind(t,8559))},8559:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eH});var a=t(4684),r=t(4464),l=t(552),n=t(2838),i=t(2010);function o(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,i.QP)((0,n.$)(s))}function d(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)}let c=(0,l.F)("inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function m(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{className:o(c({variant:t}),s),...r})}var u=t(4660);let x=(0,l.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground shadow hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",outline:"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2",sm:"h-8 rounded-md px-3 text-xs",lg:"h-10 rounded-md px-8",icon:"h-9 w-9"}},defaultVariants:{variant:"default",size:"default"}}),h=r.forwardRef((e,s)=>{let{className:t,variant:r,size:l,asChild:n=!1,...i}=e,d=n?u.DX:"button";return(0,a.jsx)(d,{className:o(x({variant:r,size:l,className:t})),ref:s,...i})});h.displayName="Button";var p=t(5488),f=t(4908),g=t(2805),j=t(3369),v=t(2408),N=t(8089);function y(e){let{onToggleSearch:s,onToggleSessions:t,onToggleServers:r,isSessionsPanelOpen:l,isServersPanelOpen:n}=e;return(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:s,className:"h-8 w-8 p-0",title:"Search (⌘⇧S)",children:(0,a.jsx)(p.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:t,className:o("h-8 w-8 p-0",l&&"bg-muted"),title:"Sessions (⌘H)",children:l?(0,a.jsx)(f.A,{className:"w-4 h-4"}):(0,a.jsx)(g.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:r,className:o("h-8 w-8 p-0",n&&"bg-muted"),title:"Tools & Servers (⌘J)",children:n?(0,a.jsx)(f.A,{className:"w-4 h-4"}):(0,a.jsx)(j.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{let e=new KeyboardEvent("keydown",{key:"e",shiftKey:!0,metaKey:navigator.platform.toUpperCase().indexOf("MAC")>=0,ctrlKey:0>navigator.platform.toUpperCase().indexOf("MAC")});window.dispatchEvent(e)},className:"h-8 w-8 p-0",title:"Export Config (⌘⇧E)",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{let e=new KeyboardEvent("keydown",{key:"/",metaKey:navigator.platform.toUpperCase().indexOf("MAC")>=0,ctrlKey:0>navigator.platform.toUpperCase().indexOf("MAC")});window.dispatchEvent(e)},className:"h-8 w-8 p-0",title:"Shortcuts (⌘/)",children:(0,a.jsx)(N.A,{className:"w-4 h-4"})})]})}function b(e){let{currentSessionId:s,isWelcomeState:t,onToggleSearch:r,onToggleSessions:l,onToggleServers:n,isSessionsPanelOpen:i,isServersPanelOpen:o}=e;return(0,a.jsx)("header",{className:"shrink-0 border-b border-border/50 bg-background/80 backdrop-blur-xl",children:(0,a.jsxs)("div",{className:"flex justify-between items-center px-4 py-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-7 h-7 rounded-lg border border-border/50 text-primary-foreground",children:(0,a.jsx)("img",{src:"/cipher-logo.png",alt:"Cipher",className:"w-4 h-4"})}),(0,a.jsx)("h1",{className:"text-base font-semibold tracking-tight",children:"Cipher"})]}),s&&!t&&(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)(m,{variant:"outline",className:"text-xs",children:s})})]}),(0,a.jsx)(y,{onToggleSearch:r,onToggleSessions:l,onToggleServers:n,isSessionsPanelOpen:i,isServersPanelOpen:o})]})})}let w=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,"data-slot":"card",className:o("rounded-xl border bg-card text-card-foreground shadow",t),...r})});w.displayName="Card",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,"data-slot":"card-header",className:o("flex flex-col space-y-1.5 p-6",t),...r})}).displayName="CardHeader",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h3",{ref:s,className:o("font-semibold leading-none tracking-tight",t),...r})}).displayName="CardTitle",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("p",{ref:s,className:o("text-sm text-muted-foreground",t),...r})}).displayName="CardDescription";let C=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,"data-slot":"card-content",className:o("p-6 pt-0",t),...r})});function S(e){let{action:s}=e;return(0,a.jsx)(w,{className:"group hover:shadow-md transition-all duration-200 cursor-pointer border-border/50 hover:border-border",children:(0,a.jsx)(C,{className:"p-4",children:(0,a.jsxs)(h,{variant:"ghost",onClick:s.action,className:"w-full h-auto p-0 flex flex-col items-start space-y-2 hover:bg-transparent",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 w-full",children:[(0,a.jsx)("span",{className:"text-lg",role:"img","aria-label":s.title,children:s.icon}),(0,a.jsx)("span",{className:"font-medium text-sm text-left",children:s.title})]}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground text-left w-full",children:s.description})]})})})}function k(e){let{quickActions:s}=e;return(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-6",children:(0,a.jsxs)("div",{className:"w-full max-w-md space-y-8",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-16 h-16 mx-auto rounded-2xl bg-primary/10 text-primary",children:(0,a.jsx)("img",{src:"/cipher-logo.png",alt:"Cipher",className:"w-8 h-8"})}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("h2",{className:"text-2xl font-semibold tracking-tight font-mono bg-gradient-to-r from-primary to-primary/70 bg-clip-text text-transparent text-center",children:"Hello, Welcome to Cipher!"}),(0,a.jsx)("p",{className:"text-muted-foreground text-base text-center",children:"Ask anything or connect new tools to expand what you can do."})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg mx-auto",children:s.map((e,s)=>(0,a.jsx)(S,{action:e},s))}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground space-y-1 text-center",children:(0,a.jsxs)("p",{children:["\uD83D\uDCA1 Try ",(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs",children:"⌘K"})," for new chat, ",(0,a.jsx)("kbd",{className:"px-1.5 py-0.5 bg-muted rounded text-xs",children:"⌘J"})," for tools"]})})]})})}function A(e){let{isOpen:s,width:t="w-80",children:r,side:l="right"}=e;return(0,a.jsx)("div",{className:o("shrink-0 transition-all duration-300 ease-in-out border-border/50 bg-card","right"===l?"border-l":"border-r",s?t:"w-0 overflow-hidden"),children:s&&r})}function T(e){let{message:s,onDismiss:t}=e;return s?(0,a.jsx)("div",{className:"absolute top-4 right-4 z-50 bg-destructive text-destructive-foreground px-4 py-2 rounded-md shadow-lg",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{children:s}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:t,className:"ml-2 h-auto p-1 text-destructive-foreground/80 hover:text-destructive-foreground hover:bg-destructive-foreground/10",children:(0,a.jsx)(f.A,{className:"h-4 w-4"})})]})}):null}C.displayName="CardContent",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,"data-slot":"card-footer",className:o("flex items-center p-6 pt-0",t),...r})}).displayName="CardFooter";var E=t(7423);let R=E.bL;E.l9;let _=E.ZL;E.bm;let D=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(E.hJ,{ref:s,className:o("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});D.displayName=E.hJ.displayName;let z=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(_,{children:[(0,a.jsx)(D,{}),(0,a.jsxs)(E.UC,{ref:s,className:o("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...l,children:[r,(0,a.jsxs)(E.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});z.displayName=E.UC.displayName;let O=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:o("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};O.displayName="DialogHeader";let P=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:o("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};P.displayName="DialogFooter";let F=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(E.hE,{ref:s,className:o("text-lg font-semibold leading-none tracking-tight",t),...r})});F.displayName=E.hE.displayName;let L=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(E.VY,{ref:s,className:o("text-sm text-muted-foreground",t),...r})});L.displayName=E.VY.displayName;let I=r.forwardRef((e,s)=>{let{className:t,type:r,...l}=e;return(0,a.jsx)("input",{type:r,"data-slot":"input",className:o("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...l})});I.displayName="Input";var M=t(2732);let V=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(M.b,{ref:s,"data-slot":"label",className:o("flex items-center gap-2 text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t),...r})});V.displayName=M.b.displayName;let U=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsx)("div",{ref:s,className:o("relative overflow-auto",t),...l,children:r})});U.displayName="ScrollArea";var q=t(7337),J=t(9798),B=t(6444),K=t(4662),H=t(2550),W=t(2988),Y=t(7823);function G(e){let{isOpen:s,onClose:t,currentSessionId:l,onSessionChange:n,returnToWelcome:i,variant:d="modal",className:c}=e,[u,x]=r.useState([]),[p,j]=r.useState(!1),[v,N]=r.useState(null),[y,b]=r.useState(!1),[w,C]=r.useState(""),[S,k]=r.useState(null),[A,T]=r.useState(!1),[E,_]=r.useState(null),[D,M]=r.useState(!1),G=r.useCallback(e=>{if(!e)return"Unknown";let s=new Date(e);return s.toLocaleDateString()+" "+s.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})},[]),Z=r.useCallback(e=>{if(!e)return"Unknown";let s=new Date(e),t=new Date().getTime()-s.getTime(),a=Math.floor(t/6e4),r=Math.floor(t/36e5),l=Math.floor(t/864e5);return a<1?"Just now":a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):"".concat(l,"d ago")},[]),$=r.useCallback(async()=>{j(!0),N(null);try{let e=await fetch("/api/sessions");if(!e.ok)throw Error("Failed to fetch sessions");let s=await e.json();x(s.sessions||[])}catch(e){console.error("Error fetching sessions:",e),N(e instanceof Error?e.message:"Failed to fetch sessions")}finally{j(!1)}},[]);r.useEffect(()=>{s&&$()},[s,$]),r.useEffect(()=>{let e=()=>{s&&$()},t=()=>{s&&$()};return window.addEventListener("cipher:message",e),window.addEventListener("cipher:response",t),()=>{window.removeEventListener("cipher:message",e),window.removeEventListener("cipher:response",t)}},[s,$]);let Q=async()=>{try{let e=await fetch("/api/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:w.trim()||void 0})});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to create session")}let s=await e.json();x(e=>[...e,s.session]),C(""),b(!1),n(s.session.id)}catch(e){console.error("Error creating session:",e),N(e instanceof Error?e.message:"Failed to create session")}},X=async e=>{k(e);try{let s=await fetch("/api/sessions/".concat(e),{method:"DELETE"});if(!s.ok){let e=await s.json();throw Error(e.error||"Failed to delete session")}x(s=>s.filter(s=>s.id!==e)),l===e&&i()}catch(e){console.error("Error deleting session:",e),N(e instanceof Error?e.message:"Failed to delete session")}finally{k(null)}},ee=async()=>{if(E){M(!0);try{if(!(await fetch("/api/sessions/".concat(E),{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw Error("Failed to delete conversation");x(e=>e.filter(e=>e.id!==E)),l===E&&i(),T(!1),_(null)}catch(e){console.error("Error deleting conversation:",e),N(e instanceof Error?e.message:"Failed to delete conversation")}finally{M(!1)}}},es=e=>{let{session:s,onDeleteConversation:t,onDeleteSession:r}=e;return(0,a.jsx)("div",{className:"flex items-center space-x-1",children:s.messageCount>0?(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),t()},className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete Conversation",children:(0,a.jsx)(q.A,{className:"h-4 w-4 text-destructive"})}):(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),r()},className:"h-8 w-8 p-0 opacity-0 group-hover:opacity-100 transition-opacity",title:"Delete Session",disabled:S===s.id,children:S===s.id?(0,a.jsx)(J.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(q.A,{className:"h-4 w-4 text-destructive"})})})},et=e=>{let{session:s,isActive:t,onSelect:r,onDelete:l}=e;return(0,a.jsx)("div",{className:o("group p-3 rounded-lg border border-border/50 bg-card hover:bg-muted/50 transition-all cursor-pointer",t&&"ring-2 ring-primary bg-primary/5"),onClick:r,children:(0,a.jsxs)("div",{className:"flex items-start justify-between",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,a.jsx)("h3",{className:"font-medium text-sm truncate",children:s.id}),t&&(0,a.jsx)(m,{variant:"secondary",className:"text-xs",children:"Active"})]}),(0,a.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(B.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:[s.messageCount," messages"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(K.A,{className:"h-3 w-3"}),(0,a.jsx)("span",{children:Z(s.lastActivity)})]})]}),s.createdAt&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(H.A,{className:"h-3 w-3"}),(0,a.jsxs)("span",{children:["Created ",G(s.createdAt)]})]})]})]}),(0,a.jsx)(es,{session:s,onDeleteConversation:l,onDeleteSession:()=>X(s.id)})]})})},ea=e=>{let{isOpen:s,onClose:t,sessionId:r,setSessionId:l,onConfirm:n}=e;return(0,a.jsx)(R,{open:s,onOpenChange:t,children:(0,a.jsxs)(z,{className:"sm:max-w-md",children:[(0,a.jsx)(O,{children:(0,a.jsx)(F,{children:"Create New Session"})}),(0,a.jsx)("div",{className:"space-y-4",children:(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V,{htmlFor:"sessionId",children:"Session ID"}),(0,a.jsx)(I,{id:"sessionId",value:r,onChange:e=>l(e.target.value),placeholder:"e.g., user-123, project-alpha",className:"font-mono"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Leave empty to auto-generate a unique ID"})]})}),(0,a.jsxs)(P,{children:[(0,a.jsx)(h,{variant:"outline",onClick:t,children:"Cancel"}),(0,a.jsx)(h,{onClick:n,children:"Create Session"})]})]})})},er=e=>{let{isOpen:s,onClose:t,onConfirm:r,sessionId:l,isDeleting:n}=e;return(0,a.jsx)(R,{open:s,onOpenChange:t,children:(0,a.jsxs)(z,{className:"sm:max-w-md",children:[(0,a.jsxs)(O,{children:[(0,a.jsxs)(F,{className:"flex items-center space-x-2",children:[(0,a.jsx)(q.A,{className:"h-5 w-5 text-destructive"}),(0,a.jsx)("span",{children:"Delete Conversation"})]}),(0,a.jsxs)(L,{children:["This will permanently delete this conversation and all its messages. This action cannot be undone.",l&&(0,a.jsxs)("span",{className:"block mt-2 font-medium",children:["Session: ",(0,a.jsx)("span",{className:"font-mono",children:l})]})]})]}),(0,a.jsxs)(P,{children:[(0,a.jsx)(h,{variant:"outline",onClick:t,children:"Cancel"}),(0,a.jsxs)(h,{variant:"destructive",onClick:r,disabled:n,className:"flex items-center space-x-2",children:[(0,a.jsx)(q.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:n?"Deleting...":"Delete Conversation"})]})]})]})})},el=()=>(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(g.A,{className:"w-5 h-5"}),(0,a.jsxs)("h2",{className:"font-semibold",children:["Sessions (",u.length,")"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(h,{variant:"outline",size:"sm",onClick:()=>b(!0),children:[(0,a.jsx)(W.A,{className:"w-4 h-4 mr-1"}),"New Session"]}),"modal"===d&&(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:t,children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})]}),v&&(0,a.jsxs)("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-700",children:[(0,a.jsx)(Y.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Error"})]}),(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:v})]}),p?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(J.A,{className:"w-6 h-6 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading sessions..."})]}):0===u.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(g.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{className:"text-sm font-medium mb-1",children:"No sessions found"}),(0,a.jsx)("p",{className:"text-xs",children:"Create a new session to get started"})]}):(0,a.jsx)(U,{className:"h-96",children:(0,a.jsx)("div",{className:"space-y-2",children:u.map(e=>(0,a.jsx)(et,{session:e,isActive:l===e.id,onSelect:()=>n(e.id),onDelete:()=>{_(e.id),T(!0)}},e.id))})}),(0,a.jsx)(ea,{isOpen:y,onClose:()=>b(!1),sessionId:w,setSessionId:C,onConfirm:Q}),(0,a.jsx)(er,{isOpen:A,onClose:()=>{T(!1),_(null)},onConfirm:ee,sessionId:E,isDeleting:D})]});return"modal"===d?(0,a.jsx)(R,{open:s,onOpenChange:e=>!e&&t(),children:(0,a.jsx)(z,{className:"max-w-2xl max-h-[80vh]",children:(0,a.jsx)(el,{})})}):(0,a.jsx)("div",{className:o("p-4 border rounded-lg bg-background",c),children:(0,a.jsx)(el,{})})}let Z=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("textarea",{"data-slot":"textarea",className:o("flex min-h-16 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 field-sizing-content",t),ref:s,...r})});Z.displayName="Textarea";var $=t(8125),Q=t(3254),X=t(8987),ee=t(6e3);let es=$.bL;$.YJ;let et=$.WT,ea=r.forwardRef((e,s)=>{let{className:t,children:r,size:l="default",...n}=e;return(0,a.jsxs)($.l9,{ref:s,className:o("flex w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent shadow-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1","default"===l?"h-9 px-3 py-2 text-sm":"h-8 px-2.5 py-1.5 text-xs",t),...n,children:[r,(0,a.jsx)($.In,{asChild:!0,children:(0,a.jsx)(Q.A,{className:"h-4 w-4 opacity-50"})})]})});ea.displayName=$.l9.displayName;let er=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)($.PP,{ref:s,className:o("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(X.A,{className:"h-4 w-4"})})});er.displayName=$.PP.displayName;let el=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)($.wn,{ref:s,className:o("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(Q.A,{className:"h-4 w-4"})})});el.displayName=$.wn.displayName;let en=r.forwardRef((e,s)=>{let{className:t,children:r,position:l="popper",...n}=e;return(0,a.jsx)($.ZL,{children:(0,a.jsxs)($.UC,{ref:s,className:o("relative z-50 max-h-96 min-w-32 overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:l,...n,children:[(0,a.jsx)(er,{}),(0,a.jsx)($.LM,{className:o("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(el,{})]})})});en.displayName=$.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)($.JU,{ref:s,className:o("px-2 py-1.5 text-sm font-semibold",t),...r})}).displayName=$.JU.displayName;let ei=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)($.q7,{ref:s,className:o("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...l,children:[(0,a.jsx)("span",{className:"absolute right-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)($.VF,{children:(0,a.jsx)(ee.A,{className:"h-4 w-4"})})}),(0,a.jsx)($.p4,{children:r})]})});ei.displayName=$.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)($.wv,{ref:s,className:o("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=$.wv.displayName;let eo=()=>({key:"",value:"",id:d()}),ed=r.forwardRef((e,s)=>{let{pairs:t,onChange:l,placeholder:n,className:i,...o}=e;r.useEffect(()=>{0===t.length&&l([eo()])},[t.length,l]);let d=e=>{let s=t.filter(s=>s.id!==e);l(0===s.length?[eo()]:s)},c=(e,s,a)=>{l(t.map(t=>t.id===e?{...t,[s]:a}:t))};return(0,a.jsx)("div",{ref:s,className:i,...o,children:(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsx)("div",{className:"col-span-5 text-sm font-medium text-muted-foreground",children:"Key"}),(0,a.jsx)("div",{className:"col-span-6 text-sm font-medium text-muted-foreground",children:"Value"}),(0,a.jsx)("div",{className:"col-span-1"})]}),t.map(e=>(0,a.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-center",children:[(0,a.jsx)("div",{className:"col-span-5",children:(0,a.jsx)(I,{value:e.key,onChange:s=>c(e.id,"key",s.target.value),placeholder:(null==n?void 0:n.key)||"Key"})}),(0,a.jsx)("div",{className:"col-span-6",children:(0,a.jsx)(I,{value:e.value,onChange:s=>c(e.id,"value",s.target.value),placeholder:(null==n?void 0:n.value)||"Value"})}),(0,a.jsx)("div",{className:"col-span-1",children:(0,a.jsxs)(h,{type:"button",variant:"ghost",size:"icon",onClick:()=>d(e.id),className:"h-9 w-9",children:[(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Remove pair"})]})})]},e.id)),(0,a.jsxs)(h,{type:"button",variant:"outline",size:"sm",onClick:()=>{l([...t,eo()])},className:"w-full",children:[(0,a.jsx)(W.A,{className:"h-4 w-4"}),"Add Pair"]})]})})});ed.displayName="KeyValueEditor";let ec=()=>({key:"",value:"",id:d()});function em(e){var s,t,l,n,i,o,d,c,m,u;let{open:x,onOpenChange:p,onSubmit:f}=e,[g,j]=r.useState(!1),[v,N]=r.useState({name:"",description:"",category:"custom",icon:"",version:"1.0.0",author:"",homepage:"",config:{type:"stdio",command:"",args:[],url:"",env:{},headers:{},timeout:3e4},tags:[],isInstalled:!1,requirements:{platform:"all",node:"",python:"",dependencies:[]}}),[y,b]=r.useState(""),[w,C]=r.useState(""),[S,k]=r.useState(""),[A,T]=r.useState(""),[E,_]=r.useState([ec()]),[D,M]=r.useState({}),V=()=>{N({name:"",description:"",category:"custom",icon:"",version:"1.0.0",author:"",homepage:"",config:{type:"stdio",command:"",args:[],url:"",env:{},headers:{},timeout:3e4},tags:[],isInstalled:!1,requirements:{platform:"all",node:"",python:"",dependencies:[]}}),b(""),C(""),k(""),T(""),_([ec()]),M({})},U=(e,s)=>{N(t=>({...t,[e]:s}))},q=(e,s)=>{N(t=>({...t,config:{...t.config,[e]:s}}))},J=(e,s)=>{N(t=>({...t,requirements:{...t.requirements,[e]:s}}))},B=e=>e.split(",").map(e=>e.trim()).filter(Boolean),K=e=>{let s={};for(let t of e.split("\n")){let e=t.trim();if(!e)continue;let a=e.indexOf("=");if(a>0){let t=e.substring(0,a).trim(),r=e.substring(a+1).trim();t&&(s[t]=r)}}return s},H=e=>{let s={};return e.forEach(e=>{e.key.trim()&&e.value.trim()&&(s[e.key.trim()]=e.value.trim())}),s},W=()=>{var e,s,t,a,r,l,n;let i={};return(null==(e=v.name)?void 0:e.trim())||(i.name="Name is required"),(null==(s=v.description)?void 0:s.trim())||(i.description="Description is required"),(null==(t=v.config)?void 0:t.type)==="stdio"?(null==(l=v.config.command)?void 0:l.trim())||(i.command="Command is required for stdio servers"):((null==(a=v.config)?void 0:a.type)==="sse"||(null==(r=v.config)?void 0:r.type)==="streamable-http")&&((null==(n=v.config.url)?void 0:n.trim())||(i.url="URL is required for SSE/HTTP servers")),M(i),0===Object.keys(i).length},Y=async e=>{if(e.preventDefault(),W()){j(!0);try{let e={...v,id:v.id||"custom-".concat(Date.now()),name:v.name,description:v.description,category:v.category,icon:v.icon||"\uD83D\uDD27",version:v.version||"1.0.0",author:v.author||"",homepage:v.homepage||"",config:{...v.config,args:B(y),env:K(S),headers:H(E)},tags:B(w),isInstalled:!1,isOfficial:!1,lastUpdated:new Date().toISOString(),requirements:{...v.requirements,dependencies:B(A)}};await f(e),V(),p(!1)}catch(e){console.error("Failed to add server:",e)}finally{j(!1)}}},G=(null==(s=v.config)?void 0:s.type)==="stdio",$=(null==(t=v.config)?void 0:t.type)==="sse"||(null==(l=v.config)?void 0:l.type)==="streamable-http";return(0,a.jsx)(R,{open:x,onOpenChange:p,children:(0,a.jsxs)(z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)(O,{children:[(0,a.jsx)(F,{children:"Add Custom MCP Server"}),(0,a.jsx)(L,{children:"Configure a new MCP server with its connection details and metadata."})]}),(0,a.jsxs)("form",{onSubmit:Y,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Basic Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Name *"}),(0,a.jsx)(I,{value:v.name||"",onChange:e=>U("name",e.target.value),placeholder:"My Custom Server",className:D.name?"border-red-500":""}),D.name&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:D.name})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Version"}),(0,a.jsx)(I,{value:v.version||"",onChange:e=>U("version",e.target.value),placeholder:"1.0.0"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Description *"}),(0,a.jsx)(Z,{value:v.description||"",onChange:e=>U("description",e.target.value),placeholder:"Brief description of what this server does",className:D.description?"border-red-500":""}),D.description&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:D.description})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Category"}),(0,a.jsxs)(es,{value:v.category,onValueChange:e=>U("category",e),children:[(0,a.jsx)(ea,{children:(0,a.jsx)(et,{})}),(0,a.jsxs)(en,{children:[(0,a.jsx)(ei,{value:"productivity",children:"Productivity"}),(0,a.jsx)(ei,{value:"development",children:"Development"}),(0,a.jsx)(ei,{value:"research",children:"Research"}),(0,a.jsx)(ei,{value:"creative",children:"Creative"}),(0,a.jsx)(ei,{value:"data",children:"Data"}),(0,a.jsx)(ei,{value:"communication",children:"Communication"}),(0,a.jsx)(ei,{value:"custom",children:"Custom"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Icon"}),(0,a.jsx)(I,{value:v.icon||"",onChange:e=>U("icon",e.target.value),placeholder:"\uD83D\uDD27"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Author"}),(0,a.jsx)(I,{value:v.author||"",onChange:e=>U("author",e.target.value),placeholder:"Your Name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Homepage"}),(0,a.jsx)(I,{value:v.homepage||"",onChange:e=>U("homepage",e.target.value),placeholder:"https://github.com/user/repo"})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Server Configuration"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Server Type"}),(0,a.jsxs)(es,{value:null==(n=v.config)?void 0:n.type,onValueChange:e=>q("type",e),children:[(0,a.jsx)(ea,{children:(0,a.jsx)(et,{})}),(0,a.jsxs)(en,{children:[(0,a.jsx)(ei,{value:"stdio",children:"Standard I/O (Local Process)"}),(0,a.jsx)(ei,{value:"sse",children:"Server-Sent Events"}),(0,a.jsx)(ei,{value:"streamable-http",children:"Streamable HTTP"})]})]})]}),G&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Command *"}),(0,a.jsx)(I,{value:(null==(i=v.config)?void 0:i.command)||"",onChange:e=>q("command",e.target.value),placeholder:"node",className:D.command?"border-red-500":""}),D.command&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:D.command})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Arguments"}),(0,a.jsx)(I,{value:y,onChange:e=>b(e.target.value),placeholder:"server.js, --port=3000"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Comma-separated arguments"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Environment Variables"}),(0,a.jsx)(Z,{value:S,onChange:e=>k(e.target.value),placeholder:"API_KEY=your_key DEBUG=true",rows:3}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"KEY=value format, one per line"})]})]}),$&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"URL *"}),(0,a.jsx)(I,{value:(null==(o=v.config)?void 0:o.url)||"",onChange:e=>q("url",e.target.value),placeholder:"https://api.example.com/mcp",className:D.url?"border-red-500":""}),D.url&&(0,a.jsx)("p",{className:"text-sm text-red-500 mt-1",children:D.url})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Headers"}),(0,a.jsx)(ed,{pairs:E,onChange:_,placeholder:{key:"Authorization",value:"Bearer token"}})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Timeout (ms)"}),(0,a.jsx)(I,{type:"number",value:(null==(d=v.config)?void 0:d.timeout)||3e4,onChange:e=>q("timeout",parseInt(e.target.value)||3e4),placeholder:"30000"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Requirements"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Platform"}),(0,a.jsxs)(es,{value:null==(c=v.requirements)?void 0:c.platform,onValueChange:e=>J("platform",e),children:[(0,a.jsx)(ea,{children:(0,a.jsx)(et,{})}),(0,a.jsxs)(en,{children:[(0,a.jsx)(ei,{value:"all",children:"All Platforms"}),(0,a.jsx)(ei,{value:"darwin",children:"macOS"}),(0,a.jsx)(ei,{value:"linux",children:"Linux"}),(0,a.jsx)(ei,{value:"win32",children:"Windows"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Node Version"}),(0,a.jsx)(I,{value:(null==(m=v.requirements)?void 0:m.node)||"",onChange:e=>J("node",e.target.value),placeholder:">=18.0.0"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Python Version"}),(0,a.jsx)(I,{value:(null==(u=v.requirements)?void 0:u.python)||"",onChange:e=>J("python",e.target.value),placeholder:">=3.8"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Dependencies"}),(0,a.jsx)(I,{value:A,onChange:e=>T(e.target.value),placeholder:"numpy, pandas"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Comma-separated packages"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Tags"}),(0,a.jsx)(I,{value:w,onChange:e=>C(e.target.value),placeholder:"api, database, utility"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Comma-separated tags"})]}),(0,a.jsxs)(P,{children:[(0,a.jsx)(h,{type:"button",variant:"outline",onClick:()=>p(!1),disabled:g,children:"Cancel"}),(0,a.jsx)(h,{type:"submit",disabled:g,children:g?"Adding...":"Add Server"})]})]})]})})}let eu=(0,l.F)("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),ex=r.forwardRef((e,s)=>{let{className:t,variant:r,...l}=e;return(0,a.jsx)("div",{ref:s,role:"alert",className:o(eu({variant:r}),t),...l})});ex.displayName="Alert",r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("h5",{ref:s,className:o("mb-1 font-medium leading-none tracking-tight",t),...r})}).displayName="AlertTitle";let eh=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)("div",{ref:s,className:o("text-sm [&_p]:leading-relaxed",t),...r})});eh.displayName="AlertDescription";var ep=t(1243),ef=t(1404),eg=t(9141),ej=t(3007);function ev(e){let{isOpen:s=!0,onClose:t,variant:l="overlay",className:n}=e,[i,d]=r.useState([]),[c,m]=r.useState(null),[u,x]=r.useState([]),[p,g]=r.useState(!1),[j,v]=r.useState(!1),[N,y]=r.useState(null),[b,w]=r.useState(null),[C,S]=r.useState(!1),[k,A]=r.useState(null),[T,E]=r.useState(!1),R=r.useCallback((e,s)=>{console.error("ServersPanel Error (".concat(s,"):"),e),"servers"===s&&y(e),"tools"===s&&w(e)},[]),_=r.useCallback(async e=>{g(!0),y(null),d([]),m(null),x([]),w(null);try{let s=await fetch("/api/mcp/servers",e?{signal:e}:{});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to fetch servers"}));throw Error(e.message||e.error||"Server List: ".concat(s.statusText))}let t=(await s.json()).servers||[];if(d(t),t.length>0){let e=t.find(e=>"connected"===e.status);e?m(e.id):t.length>0&&m(t[0].id)}}catch(e){"AbortError"!==e.name&&R(e.message,"servers")}finally{(null==e?void 0:e.aborted)||g(!1)}},[R]),D=r.useCallback(async(e,s)=>{let t=i.find(s=>s.id===e);if(x([]),w(null),!t||"connected"!==t.status)return void console.warn('Server "'.concat((null==t?void 0:t.name)||e,'" is not connected or not found. Cannot fetch tools.'));v(!0);try{let a=await fetch("/api/mcp/servers/".concat(e,"/tools"),s?{signal:s}:{});if(!a.ok){let e=await a.json().catch(()=>({error:"Failed to fetch tools for ".concat(t.name)}));throw Error(e.message||e.error||"Tool List (".concat(t.name,"): ").concat(a.statusText))}let r=await a.json();(null==s?void 0:s.aborted)||x(r.tools||[]),r.tools&&0!==r.tools.length||console.log('No tools found for server "'.concat(t.name,'".'))}catch(e){"AbortError"!==e.name&&R(e.message,"tools")}finally{(null==s?void 0:s.aborted)||v(!1)}},[i,R]),z=async e=>{E(!1);let s={type:e.config.type,command:e.config.command,args:e.config.args||[],url:e.config.url,env:e.config.env||{},headers:e.config.headers||{},timeout:e.config.timeout||3e4};try{let t=await fetch("/api/connect-server",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e.name,config:s})}),a=await t.json();if(!t.ok)throw Error(a.error||"Server returned status ".concat(t.status));await _()}catch(e){R(e.message||"Failed to install server","servers")}},O=async e=>{let s=i.find(s=>s.id===e);if(s&&window.confirm('Are you sure you want to remove server "'.concat(s.name,'"?'))){A(e),y(null);try{let s=await fetch("/api/mcp/servers/".concat(e),{method:"DELETE"});if(!s.ok){let e=await s.json().catch(()=>({error:"Failed to remove server"}));throw Error(e.message||e.error||"Server Removal: ".concat(s.statusText))}c===e&&(m(null),x([])),await _()}catch(e){R(e.message,"servers")}finally{A(null)}}};r.useEffect(()=>{if(!s)return;let e=new AbortController;return _(e.signal),A(null),()=>{e.abort()}},[s,_]),r.useEffect(()=>{if(!c)return;let e=new AbortController;return D(c,e.signal),()=>{e.abort()}},[c,D]);let P=e=>{switch(e){case"connected":return"bg-green-500";case"error":return"bg-red-500";default:return"bg-yellow-500"}},F=e=>{let{status:s}=e;return(0,a.jsx)("div",{className:o("w-2 h-2 rounded-full flex-shrink-0",P(s))})},L=e=>{var s;let{tool:t}=e;return(null==(s=t.inputSchema)?void 0:s.properties)&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[Object.keys(t.inputSchema.properties).slice(0,3).map(e=>(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-md bg-muted text-xs font-medium",children:e},e)),Object.keys(t.inputSchema.properties).length>3&&(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:["+",Object.keys(t.inputSchema.properties).length-3," more"]})]})},I=i.find(e=>e.id===c);return(0,a.jsxs)("div",{className:o("overlay"===l?o("fixed top-0 right-0 z-40 h-screen w-80 bg-card border-l border-border shadow-xl transition-transform transform flex flex-col",s?"translate-x-0":"translate-x-full"):"h-full w-full flex flex-col bg-card",n),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(ep.A,{className:"w-5 h-5"}),(0,a.jsx)("h2",{className:"font-semibold",children:"MCP Servers"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>_(),disabled:p,children:(0,a.jsx)(ef.A,{className:o("w-4 h-4",p&&"animate-spin")})}),"overlay"===l&&t&&(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:t,children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})]}),N&&(0,a.jsxs)("div",{className:"mx-4 mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-red-700",children:[(0,a.jsx)(Y.A,{className:"w-4 h-4"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:"Server Error"})]}),(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:N})]}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-h-0",children:[(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("h3",{className:"text-sm font-medium",children:["Connected Servers (",i.length,")"]}),(0,a.jsxs)(h,{variant:"outline",size:"sm",onClick:()=>E(!0),children:[(0,a.jsx)(W.A,{className:"w-4 h-4 mr-1"}),"Add"]})]}),p?(0,a.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,a.jsx)(J.A,{className:"w-6 h-6 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-2 text-sm text-muted-foreground",children:"Loading servers..."})]}):0===i.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(ep.A,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),(0,a.jsx)("p",{className:"text-sm font-medium mb-1",children:"No servers connected"}),(0,a.jsx)("p",{className:"text-xs",children:"Add a server to get started"})]}):(0,a.jsx)(U,{className:"flex-1",children:(0,a.jsx)("div",{className:"space-y-2",children:i.map(e=>{var s;return(0,a.jsx)("div",{className:o("p-3 rounded-lg border cursor-pointer transition-colors",c===e.id?"bg-accent border-accent-foreground/20":"bg-card hover:bg-muted/50"),onClick:()=>m(e.id),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,a.jsx)(F,{status:e.status}),(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium truncate",children:e.name}),(0,a.jsxs)("p",{className:"text-xs text-muted-foreground capitalize",children:[e.status," • ",(null==(s=e.config)?void 0:s.type)||"unknown"]})]})]}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:s=>{s.stopPropagation(),O(e.id)},disabled:k===e.id,className:"h-6 w-6 p-0",children:k===e.id?(0,a.jsx)(J.A,{className:"w-3 h-3 animate-spin"}):(0,a.jsx)(q.A,{className:"w-3 h-3"})})]})},e.id)})})})]}),I&&(0,a.jsxs)("div",{className:"border-t p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.A,{className:"w-4 h-4"}),(0,a.jsxs)("h3",{className:"text-sm font-medium",children:["Tools (",u.length,")"]})]}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>S(!C),className:"h-6 w-6 p-0",children:C?(0,a.jsx)(X.A,{className:"w-3 h-3"}):(0,a.jsx)(Q.A,{className:"w-3 h-3"})})]}),b&&(0,a.jsx)("div",{className:"mb-3 p-2 bg-red-50 border border-red-200 rounded text-xs text-red-600",children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)(Y.A,{className:"w-3 h-3"}),(0,a.jsx)("span",{children:b})]})}),C&&(0,a.jsx)("div",{className:"space-y-2",children:j?(0,a.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 animate-spin text-muted-foreground"}),(0,a.jsx)("span",{className:"ml-2 text-xs text-muted-foreground",children:"Loading tools..."})]}):0===u.length?(0,a.jsxs)("div",{className:"text-center py-4 text-muted-foreground",children:[(0,a.jsx)(eg.A,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{className:"text-xs",children:"No tools available"})]}):(0,a.jsx)(U,{className:"max-h-40",children:(0,a.jsx)("div",{className:"space-y-2",children:u.map(e=>(0,a.jsxs)("div",{className:"p-2 bg-muted/50 rounded text-xs",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)(ej.A,{className:"w-3 h-3 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:e.name})]}),e.description&&(0,a.jsx)("p",{className:"text-muted-foreground mb-1 text-xs",children:e.description}),(0,a.jsx)(L,{tool:e})]},e.name))})})})]})]}),(0,a.jsx)(em,{open:T,onOpenChange:E,onSubmit:async e=>{let s={id:Date.now().toString(),name:e.name,config:e.config};await z(s)}})]})}var eN=t(773);let ey=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eN.bL,{ref:s,className:o("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",t),...r})});ey.displayName=eN.bL.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eN._V,{ref:s,className:o("aspect-square h-full w-full",t),...r})}).displayName=eN._V.displayName;let eb=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(eN.H4,{ref:s,className:o("flex h-full w-full items-center justify-center rounded-full bg-muted",t),...r})});eb.displayName=eN.H4.displayName;var ew=t(2622),eC=t(9817),eS=t(8743),ek=t(2170),eA=t(7779),eT=t(3845);function eE(e){let{messages:s,className:t,maxHeight:l="h-96"}=e,[n,i]=r.useState({}),d=r.useRef(null),c=r.useRef(null);r.useEffect(()=>{var e;null==(e=d.current)||e.scrollIntoView({behavior:"smooth"}),c.current&&(c.current.scrollTop=c.current.scrollHeight)},[s]);let m=(e,s,t)=>{let a="user"===e.role,r="assistant"===e.role,l="system"===e.role,n=!!(e.toolName&&e.toolArgs),i=!!(e.toolName&&e.toolResult);return{isUser:a,isAi:r,isSystem:l,isLastMessage:s===t-1,isToolCall:n,isToolResult:i,isToolRelated:n||i}},u=(e,s,t)=>s&&t||!!n[e.id],x=(e,s)=>{s&&i(s=>({...s,[e.id]:!s[e.id]}))},p=(e,s)=>o("flex items-end w-full gap-2 mb-4",e?"justify-end":"justify-start",s&&"justify-center"),f=(e,s,t,a)=>o("tool"===e?"w-full text-muted-foreground/70 bg-secondary border border-muted/30 rounded-md text-sm p-3":s?"p-3 rounded-xl shadow-sm max-w-[75%] bg-primary text-primary-foreground rounded-br-none text-sm":t?"p-3 rounded-xl shadow-sm max-w-[75%] bg-card text-card-foreground border border-border rounded-bl-none text-sm":a?"p-3 shadow-none w-full bg-transparent text-xs text-muted-foreground italic text-center border-none":""),g=e=>e&&(e.error||e.isError),v=e=>e&&e.content&&Array.isArray(e.content),N=e=>{var s;return e&&("image"===e.type||e.base64||(null==(s=e.mimeType)?void 0:s.startsWith("image/")))},y=e=>e&&("text"===e.type||e.text),b=e=>e&&("file"===e.type||e.filename),w=(e,s)=>{let t=e.base64&&e.mimeType?"data:".concat(e.mimeType,";base64,").concat(e.base64):e.base64;return t&&t.startsWith("data:")&&!/^data:image\/(png|jpeg|jpg|gif|webp|svg\+xml);base64,[A-Za-z0-9+/]+={0,2}$/i.test(t)?null:(0,a.jsx)("img",{src:t,alt:"Content image",className:"my-1 max-h-48 w-auto rounded border border-border"},s)},C=(e,s)=>(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-background/50 p-2 rounded text-xs text-muted-foreground my-1",children:e.text},s),S=(e,s)=>(0,a.jsxs)("div",{className:"my-1 flex items-center gap-2 p-2 rounded border border-border bg-muted/50",children:[(0,a.jsx)(ew.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.filename||"File attachment"," (",e.mimeType,")"]})]},s),k=(e,s)=>(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-muted/50 p-2 rounded text-xs my-1",children:JSON.stringify(e,null,2)},s),A=e=>(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-background/50 p-2 rounded text-xs text-muted-foreground",children:"object"==typeof e?JSON.stringify(e,null,2):String(e)}),T=e=>g(e)?(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-red-100 text-red-700 p-2 rounded text-xs",children:"object"==typeof e.error?JSON.stringify(e.error,null,2):String(e.error)}):v(e)?e.content.map((e,s)=>N(e)?w(e,s):y(e)?C(e,s):b(e)?S(e,s):k(e,s)):A(e),E=(e,s)=>{let t="data:".concat(e.mimeType,";base64,").concat(e.base64||e.data);return(0,a.jsxs)("div",{className:"my-2 flex items-center gap-2 p-3 rounded-lg border border-border bg-muted/50",children:[(0,a.jsx)(eC.A,{className:"h-5 w-5 text-muted-foreground"}),(0,a.jsx)("audio",{controls:!0,src:t,className:"flex-1 h-8"}),e.filename&&(0,a.jsx)("span",{className:"text-sm text-muted-foreground truncate max-w-[120px]",children:e.filename})]},s)},R=e=>e?g(e)?(0,a.jsx)(eS.A,{className:"mx-2 h-4 w-4 text-red-500"}):(0,a.jsx)(ek.A,{className:"mx-2 h-4 w-4 text-green-500"}):(0,a.jsx)(J.A,{className:"mx-2 h-4 w-4 animate-spin text-muted-foreground"}),_=(e,s,t)=>(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 px-1 flex items-center gap-2",children:[(0,a.jsx)("span",{children:t}),s&&e.tokenCount&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-muted/50 text-xs",children:[(0,a.jsx)("span",{className:"w-1.5 h-1.5 rounded-full bg-green-500"}),e.tokenCount," tokens"]}),s&&e.model&&(0,a.jsx)("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-muted/30 text-xs",children:e.model})]}),D=e=>{switch(e){case"user":return(0,a.jsx)(eA.A,{className:"w-4 h-4"});case"assistant":default:return(0,a.jsx)(eT.A,{className:"w-4 h-4"});case"system":return(0,a.jsx)(j.A,{className:"w-4 h-4"});case"tool":return(0,a.jsx)(eg.A,{className:"w-4 h-4"})}},z=e=>"string"==typeof e.content?(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.content}):Array.isArray(e.content)?e.content.map((e,s)=>N(e)?w(e,s):y(e)?(0,a.jsx)("div",{className:"whitespace-pre-wrap",children:e.text},s):b(e)?S(e,s):k(e,s)):"object"==typeof e.content?(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-muted/50 p-2 rounded text-xs",children:JSON.stringify(e.content,null,2)}):(0,a.jsx)("div",{children:String(e.content)});return(0,a.jsx)(U,{className:o(l,t),ref:c,children:(0,a.jsxs)("div",{className:"space-y-1 p-4",children:[s.map((e,t)=>{var r;let{isUser:l,isAi:n,isSystem:i,isLastMessage:o,isToolCall:d,isToolResult:c,isToolRelated:g}=m(e,t,s.length),j=new Date(e.createdAt).toLocaleTimeString(),v=u(e,g,o);return(0,a.jsxs)("div",{className:p(l,i),children:[!i&&(0,a.jsx)(ey,{className:"w-8 h-8 shrink-0",children:(0,a.jsx)(eb,{className:"text-xs",children:D(e.role)})}),(0,a.jsxs)("div",{className:"flex flex-col max-w-[75%]",children:[(0,a.jsxs)("div",{className:f(e.role,l,n,i),children:[g&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(eg.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"font-medium text-sm",children:e.toolName}),R(e.toolResult)]}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>x(e,g),className:"h-6 w-6 p-0",children:v?(0,a.jsx)(X.A,{className:"h-3 w-3"}):(0,a.jsx)(Q.A,{className:"h-3 w-3"})})]}),z(e),e.imageData&&(0,a.jsx)("div",{className:"mt-2",children:(0,a.jsx)("img",{src:"data:".concat(e.imageData.mimeType,";base64,").concat(e.imageData.base64),alt:"Message attachment",className:"max-h-48 w-auto rounded border border-border"})}),e.fileData&&(0,a.jsx)("div",{className:"mt-2",children:(null==(r=e.fileData.mimeType)?void 0:r.startsWith("audio/"))?E(e.fileData,"audio-".concat(e.id)):(0,a.jsxs)("div",{className:"flex items-center gap-2 p-2 rounded border border-border bg-muted/50",children:[(0,a.jsx)(ew.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-sm text-muted-foreground",children:e.fileData.filename||"File attachment"})]})}),g&&v&&(0,a.jsxs)("div",{className:"mt-3 space-y-2 border-t pt-2",children:[e.toolArgs&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium mb-1",children:"Arguments:"}),(0,a.jsx)("pre",{className:"whitespace-pre-wrap overflow-auto bg-muted/50 p-2 rounded text-xs",children:JSON.stringify(e.toolArgs,null,2)})]}),e.toolResult&&(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs font-medium mb-1",children:"Result:"}),T(e.toolResult)]})]})]}),!i&&_(e,n,j)]})]},e.id)}),(0,a.jsx)("div",{ref:d})]})})}var eR=t(5963),e_=t(5742),eD=t(1830),ez=t(817),eO=t(5688),eP=t(160),eF=t(5602);let eL=[{name:"GPT-4.1-mini",provider:"openai",model:"gpt-4.1-mini"}];function eI(e){let{onSend:s,currentSessionId:t,disabled:l=!1,placeholder:n="Type your message...",models:i=eL}=e,[d,c]=r.useState(""),[m,u]=r.useState(null),[x,p]=r.useState(null),[g,j]=r.useState(!1),[v,N]=r.useState("Loading..."),[y,b]=r.useState(!1),[w,C]=r.useState(null),[S,k]=r.useState(null),[A,T]=r.useState(!1),E=r.useRef(null),R=r.useRef(null),_=r.useRef(null),D=r.useRef(null),z=r.useRef(null),O=r.useRef(null),P=r.useCallback(()=>{if(E.current){E.current.style.height="auto";let e=E.current.scrollHeight;E.current.style.height="".concat(Math.min(e,120),"px"),E.current.style.overflowY=e>120?"auto":"hidden"}},[]);r.useEffect(()=>{P()},[d,P]);let F=e=>({"audio/mp3":"mp3","audio/mpeg":"mp3","audio/wav":"wav","audio/x-wav":"wav","audio/wave":"wav","audio/webm":"webm","audio/ogg":"ogg","audio/m4a":"m4a","audio/aac":"aac"})[e]||e.split("/")[1]||"webm",L=e=>{k(e),setTimeout(()=>k(null),5e3)};r.useEffect(()=>{d&&(w||S)&&(C(null),k(null))},[d,w,S]);let I=(e,s,t)=>{if(e.size>0x3200000)return void L("File too large. Maximum size is 50MB.");let a=s(e);if(!a.isValid)return void L(a.error||"Invalid file type.");let r=new FileReader;r.onloadend=()=>{try{let s=r.result,a=s.indexOf(","),l=s.substring(a+1);t({base64:l,mimeType:e.type,...e.name&&{filename:e.name}}),k(null)}catch(e){L("Failed to process file. Please try again.")}},r.onerror=()=>{L("Failed to read file. Please try again.")},r.readAsDataURL(e)},M=e=>{let s=["image/jpeg","image/jpg","image/png","image/gif","image/webp"];return{isValid:s.includes(e.type),error:s.includes(e.type)?void 0:"Please select a valid image file (JPEG, PNG, GIF, WebP)"}},V=e=>({isValid:"application/pdf"===e.type,error:"application/pdf"===e.type?void 0:"Please select a valid PDF file"}),U=e=>{let s=["audio/mp3","audio/mpeg","audio/wav","audio/x-wav","audio/wave","audio/webm","audio/ogg","audio/m4a","audio/aac"];return{isValid:s.includes(e.type),error:s.includes(e.type)?void 0:"Please select a valid audio file"}},q=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);z.current=s;let t=[];s.ondataavailable=e=>{e.data.size>0&&t.push(e.data)},s.onstop=()=>{let a=new Blob(t,{type:s.mimeType}),r=new FileReader;r.onloadend=()=>{let e=r.result,t=e.indexOf(","),a=e.substring(t+1),l=s.mimeType||"audio/webm",n=F(l);p({base64:a,mimeType:l,filename:"recording.".concat(n)}),u(null)},r.readAsDataURL(a),e.getTracks().forEach(e=>e.stop())},s.start(),j(!0)}catch(e){L("Failed to start audio recording. Please check microphone permissions.")}},B=async e=>{b(!0),C(null);try{let s={provider:e.provider,model:e.model,router:"vercel",...t&&{sessionId:t}},a=await fetch("/api/llm/switch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),r=await a.json();r.success?(N(e.name),C(null)):C(r.error||"Failed to switch model")}catch(e){C("Network error while switching model")}finally{b(!1)}};r.useEffect(()=>{(async()=>{try{let s=await fetch(t?"/api/llm/current?sessionId=".concat(t):"/api/llm/current");if(s.ok){var e;let t=await s.json(),a=null==(e=t.data)?void 0:e.llmConfig;if(a){let e=i.find(e=>e.model===a.model);N(e?e.name:"".concat(a.provider,"/").concat(a.model))}else console.warn("Unexpected API response structure:",t),N("Unknown")}}catch(e){console.error("Failed to fetch current model:",e),N("Unknown")}})()},[t,i]);let K=()=>{let e=d.trim();(e||m||x)&&(s(e,null!=m?m:void 0,null!=x?x:void 0),c(""),u(null),p(null),E.current&&(E.current.style.height="auto",E.current.style.overflowY="hidden"))},H=(d.trim()||m||x)&&!l,W=m||x;return(0,a.jsxs)("div",{className:"border rounded-lg bg-background",children:[(0,a.jsx)("input",{ref:R,type:"file",accept:"image/*",onChange:e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];t&&I(t,M,e=>{u(e),p(null)}),e.target.value=""},className:"hidden"}),(0,a.jsx)("input",{ref:_,type:"file",accept:".pdf",onChange:e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];t&&I(t,V,e=>{p(e),u(null)}),e.target.value=""},className:"hidden"}),(0,a.jsx)("input",{ref:D,type:"file",accept:"audio/*",onChange:e=>{var s;let t=null==(s=e.target.files)?void 0:s[0];t&&I(t,U,e=>{p(e),u(null)}),e.target.value=""},className:"hidden"}),(w||S)&&(0,a.jsx)("div",{className:"p-3 border-b",children:(0,a.jsxs)(ex,{variant:"destructive",children:[(0,a.jsx)(Y.A,{className:"h-4 w-4"}),(0,a.jsx)(eh,{children:w||S})]})}),(0,a.jsx)("div",{className:"flex items-center justify-between p-3 border-b",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:"Model:"}),(0,a.jsxs)(es,{value:v,onValueChange:e=>{let s=i.find(s=>s.name===e);s&&B(s)},disabled:y||l,children:[(0,a.jsx)(ea,{className:"w-48",children:(0,a.jsx)(et,{children:y?(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(J.A,{className:"w-4 h-4 animate-spin"}),(0,a.jsx)("span",{children:"Switching..."})]}):v})}),(0,a.jsx)(en,{children:i.map(e=>(0,a.jsx)(ei,{value:e.name,children:e.name},e.model))})]})]})}),W&&(0,a.jsxs)("div",{className:"p-3 border-b",children:[m&&(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[(0,a.jsx)("img",{src:"data:".concat(m.mimeType,";base64,").concat(m.base64),alt:"Uploaded",className:"w-12 h-12 object-cover rounded"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:"Image uploaded"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:m.mimeType})]}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>u(null),disabled:l,children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]}),x&&(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-muted rounded-lg",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-primary/10 rounded flex items-center justify-center",children:x.mimeType.startsWith("audio/")?(0,a.jsx)(eR.A,{className:"w-6 h-6 text-primary"}):(0,a.jsx)(ew.A,{className:"w-6 h-6 text-primary"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("p",{className:"text-sm font-medium",children:x.filename||"File uploaded"}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:x.mimeType})]}),x.mimeType.startsWith("audio/")&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("audio",{ref:O,src:"data:".concat(x.mimeType,";base64,").concat(x.base64),onEnded:()=>T(!1)}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{O.current&&(A?O.current.pause():O.current.play(),T(!A))},disabled:l,children:A?(0,a.jsx)(e_.A,{className:"w-4 h-4"}):(0,a.jsx)(eD.A,{className:"w-4 h-4"})})]}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>p(null),disabled:l,children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})]}),(0,a.jsx)("div",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(Z,{ref:E,value:d,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),K())},placeholder:n,disabled:l,className:"min-h-9 resize-none border-0 shadow-none focus-visible:ring-0 p-0",style:{overflow:"hidden"}})}),(0,a.jsxs)("div",{className:"flex items-end gap-1",children:[(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{var e;return null==(e=R.current)?void 0:e.click()},disabled:l,className:"shrink-0",children:(0,a.jsx)(ez.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{var e;return null==(e=_.current)?void 0:e.click()},disabled:l,className:"shrink-0",children:(0,a.jsx)(ew.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:()=>{var e;return null==(e=D.current)?void 0:e.click()},disabled:l,className:"shrink-0",children:(0,a.jsx)(eO.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{variant:"ghost",size:"sm",onClick:g?()=>{var e;null==(e=z.current)||e.stop(),j(!1)}:q,disabled:l,className:o("shrink-0",g&&"text-red-500"),children:g?(0,a.jsx)(eP.A,{className:"w-4 h-4"}):(0,a.jsx)(eR.A,{className:"w-4 h-4"})}),(0,a.jsx)(h,{onClick:K,disabled:!H,size:"sm",className:"shrink-0",children:(0,a.jsx)(eF.A,{className:"w-4 h-4"})})]})]})})]})}var eM=t(6728);function eV(){let{status:e,isConnected:s,isConnecting:t,isStreaming:a,setStreaming:r}=useChatStatus();return _jsxs("div",{className:"flex items-center space-x-3",children:[_jsxs("div",{className:"flex items-center space-x-2",children:[_jsx("div",{className:"w-2 h-2 rounded-full ".concat((e=>{switch(e){case"open":return"bg-green-500";case"connecting":return"bg-yellow-500";case"closed":return"bg-red-500";default:return"bg-gray-500"}})(e))}),_jsx(Badge,{variant:"outline",className:"text-xs",children:e})]}),_jsxs("div",{className:"flex items-center space-x-2",children:[_jsx("label",{className:"text-sm",children:"Streaming:"}),_jsx(Button,{variant:"outline",size:"sm",onClick:()=>r(!a),className:a?"bg-blue-100":"",children:a?"On":"Off"})]})]})}function eU(){let{currentSessionId:e,isWelcomeState:s,returnToWelcome:t,switchSession:a}=useChatSession(),[r,l]=React.useState(""),n=async()=>{if(r.trim())try{await a(r.trim()),l("")}catch(e){console.error("Failed to switch session:",e)}};return _jsxs(Card,{children:[_jsx(CardHeader,{children:_jsx(CardTitle,{className:"text-sm",children:"Session Management"})}),_jsxs(CardContent,{className:"space-y-3",children:[_jsxs("div",{className:"flex items-center space-x-2",children:[_jsx("span",{className:"text-sm",children:"Current:"}),s?_jsx(Badge,{variant:"secondary",children:"Welcome State"}):_jsx(Badge,{variant:"default",className:"font-mono text-xs",children:e})]}),_jsxs("div",{className:"flex space-x-2",children:[_jsx(Input,{value:r,onChange:e=>l(e.target.value),placeholder:"Enter session ID",className:"text-xs"}),_jsx(Button,{size:"sm",onClick:n,disabled:!r.trim(),children:"Switch"})]}),_jsx(Button,{size:"sm",variant:"outline",onClick:t,disabled:s,children:"Return to Welcome"})]})]})}function eq(){let{messages:e,reset:s,messageCount:t,hasMessages:a}=useChatMessages();return _jsxs(Card,{className:"flex-1",children:[_jsx(CardHeader,{children:_jsxs("div",{className:"flex items-center justify-between",children:[_jsxs(CardTitle,{className:"text-sm",children:["Messages (",t,")"]}),_jsx(Button,{size:"sm",variant:"outline",onClick:s,disabled:!a,children:"Reset"})]})}),_jsx(CardContent,{children:_jsx(ScrollArea,{className:"h-64",children:_jsxs("div",{className:"space-y-3",children:[e.map(e=>_jsx("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:_jsxs("div",{className:"max-w-[80%] rounded-lg px-3 py-2 ".concat("user"===e.role?"bg-primary text-primary-foreground":"assistant"===e.role?"bg-muted":"system"===e.role?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"),children:[_jsx("div",{className:"text-sm",children:"tool"===e.role?_jsxs("div",{children:[_jsxs("div",{className:"font-medium",children:["\uD83D\uDD27 ",e.toolName]}),e.toolArgs&&_jsx("pre",{className:"text-xs mt-1 opacity-70",children:JSON.stringify(e.toolArgs,null,2)}),e.toolResult&&_jsxs("div",{className:"mt-2 text-xs",children:[_jsx("div",{className:"font-medium",children:"Result:"}),_jsx("pre",{className:"opacity-70",children:formatToolResult(e.toolResult)})]})]}):extractTextFromContent(e.content)}),_jsxs("div",{className:"flex items-center justify-between mt-1 text-xs opacity-70",children:[_jsx("span",{children:e.role}),_jsx("span",{children:new Date(e.createdAt).toLocaleTimeString()})]}),(e.tokenCount||e.model)&&_jsxs("div",{className:"mt-1 text-xs opacity-50",children:[e.tokenCount&&_jsxs("span",{children:[e.tokenCount," tokens"]}),e.tokenCount&&e.model&&_jsx("span",{children:" • "}),e.model&&_jsx("span",{children:e.model})]})]})},e.id)),!a&&_jsx("div",{className:"text-center text-muted-foreground text-sm py-8",children:"No messages yet. Start a conversation!"})]})})})]})}function eJ(){let{sendMessage:e}=useChatContext(),{isConnected:s}=useChatStatus(),[t,a]=React.useState(""),[r,l]=React.useState(!1),n=async()=>{if(t.trim()&&s&&!r){l(!0);try{await e(t.trim()),a("")}catch(e){console.error("Failed to send message:",e)}finally{l(!1)}}};return _jsx(Card,{children:_jsx(CardContent,{className:"pt-6",children:_jsxs("div",{className:"flex space-x-2",children:[_jsx(Input,{value:t,onChange:e=>a(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),n())},placeholder:"Type a message...",disabled:!s||r}),_jsx(Button,{onClick:n,disabled:!s||!t.trim()||r,children:r?"Sending...":"Send"})]})})})}t(6036);t(2121),t(7034),t(6588);var eB=t(1879);function eK(){let{messages:e,sendMessage:s,status:t,currentSessionId:l,switchSession:n,returnToWelcome:i,isWelcomeState:o}=(0,eM.vd)(),[d,c]=(0,r.useState)(!1),[m,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(null),p=async(e,t,a)=>{try{await s(e,t,a)}catch(e){console.error("Error sending message:",e),h("Failed to send message. Please try again."),setTimeout(()=>h(null),5e3)}},f=async e=>{try{await n(e),c(!1)}catch(e){console.error("Error switching session:",e),h("Failed to switch session. Please try again."),setTimeout(()=>h(null),5e3)}};return(0,a.jsx)("div",{className:"flex h-full bg-background",children:(0,a.jsxs)("main",{className:"flex-1 flex flex-col relative",children:[(0,a.jsx)(b,{currentSessionId:l,isWelcomeState:o,onToggleSearch:()=>{console.log("Search toggle - implement as needed")},onToggleSessions:()=>c(e=>!e),onToggleServers:()=>u(e=>!e),isSessionsPanelOpen:d,isServersPanelOpen:m}),(0,a.jsxs)("div",{className:"flex-1 flex overflow-hidden",children:[(0,a.jsxs)("div",{className:"flex-1 flex flex-col",children:[o?(0,a.jsx)(k,{quickActions:[{title:"What can you do?",description:"See current capabilities",action:()=>s("What tools and capabilities do you have available right now?"),icon:"\uD83E\uDD14"},{title:"Create Snake Game",description:"Build a game and open it",action:()=>s("Create a snake game in a new directory with HTML, CSS, and JavaScript, then open it in the browser for me to play."),icon:"\uD83D\uDC0D"},{title:"Connect new tools",description:"Browse and add MCP servers",action:()=>u(!0),icon:"\uD83D\uDD27"},{title:"Test existing tools",description:"Try out connected capabilities",action:()=>s("Show me how to use one of your available tools. Pick an interesting one and demonstrate it."),icon:"⚡"}]}):(0,a.jsx)(eE,{messages:e.map(eB.VR)}),(0,a.jsx)(eI,{onSend:p,disabled:"open"!==t})]}),(0,a.jsx)(A,{isOpen:d,width:"w-80",children:(0,a.jsx)(G,{isOpen:d,onClose:()=>c(!1),currentSessionId:l,onSessionChange:f,returnToWelcome:i,variant:"inline"})}),(0,a.jsx)(A,{isOpen:m,width:"w-80",children:(0,a.jsx)(ev,{isOpen:m,onClose:()=>u(!1)})})]}),(0,a.jsx)(T,{message:x,onDismiss:()=>h(null)})]})})}function eH(){return(0,a.jsx)(eK,{})}}},e=>{var s=s=>e(e.s=s);e.O(0,[670,728,346,83,358],()=>s(581)),_N_E=e.O()}]);